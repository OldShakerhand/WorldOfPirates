<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World of Pirates</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
    </div>

    <!-- Name Input Overlay -->
    <div id="nameInputOverlay">
        <div id="nameInputContent">
            <h1>‚öì World of Pirates ‚öì</h1>
            <p>Enter your captain's name to set sail!</p>
            <input type="text" id="playerNameInput" placeholder="Captain Name" maxlength="20" autocomplete="off">
            <div id="nameError" style="display: none;"></div>

            <!-- Custom spawn for testing -->
            <div style="margin: 10px 0; padding: 8px; background: rgba(0,0,0,0.3); border-radius: 3px;">
                <label style="font-size: 11px; color: #aaa;">Custom Spawn (testing only):</label><br>
                <input type="number" id="spawnX" placeholder="X" style="width: 80px; margin: 3px; padding: 4px;">
                <input type="number" id="spawnY" placeholder="Y" style="width: 80px; padding: 4px;">
            </div>

            <button id="setSailBtn">Set Sail! üè¥‚Äç‚ò†Ô∏è</button>
            <p class="hint">3-20 characters (letters, numbers, spaces)</p>
        </div>
    </div>

    <!-- Chat Panel (Kill Feed) -->
    <div id="chatPanel">
        <div id="chatMessages"></div>
    </div>

    <!-- Chat Input -->
    <div id="chatInputContainer" style="display: none;">
        <input type="text" id="chatInput" placeholder="Press Enter to chat..." maxlength="200" autocomplete="off">
    </div>


    <!-- Harbor UI Overlay -->
    <div id="harborUI" style="display: none;">
        <div id="harborContent">
            <h2 id="harborTitle">üè¥‚Äç‚ò†Ô∏è Harbor</h2>
            <div id="harborInfo">
                <h3>Your Fleet:</h3>
                <div id="fleetList"></div>

                <h3>Change Flagship:</h3>
                <!-- IMPORTANT: Ship stats must match src/server/game/ShipClass.js -->
                <!-- When updating ship classes, update these option texts to reflect current stats -->
                <select id="shipSelector">
                    <option value="SLOOP">Sloop (2 cannons/side, 131 speed)</option>
                    <option value="BARQUE">Barque (3 cannons/side, 120 speed)</option>
                    <option value="FLUYT">Fluyt (4 cannons/side, 115 speed)</option>
                    <option value="MERCHANT">Merchant (5 cannons/side, 104 speed)</option>
                    <option value="FRIGATE">Frigate (6 cannons/side, 112 speed)</option>
                    <option value="SPANISH_GALLEON">Spanish Galleon (8 cannons/side, 100 speed)</option>
                    <option value="WAR_GALLEON">War Galleon (12 cannons/side, 91 speed)</option>
                </select>
                <button id="switchShipBtn" onclick="switchFlagship()">Switch Flagship</button>

                <!-- Governor Section (Phase 1: Mission acceptance) -->
                <div id="governorSection" style="margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px;">
                    <h3>üéñÔ∏è Governor - Missions</h3>
                    <div id="missionList"></div>
                </div>

                <!-- Ship Upgrade Section (Phase 1: Progression) -->
                <div id="upgradeSection" style="margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px;">
                    <h3>Upgrade Ship</h3>
                    <p id="playerResources" style="font-weight: bold; color: #FFD700;">Gold: 0 | Level: 1</p>
                    <select id="upgradeShipSelector">
                        <option value="SLOOP">Sloop (500g, Lv1) - 2 cannons, 131 speed</option>
                        <option value="BARQUE">Barque (1000g, Lv2) - 3 cannons, 120 speed</option>
                        <option value="FLUYT">Fluyt (1500g, Lv3) - 4 cannons, 115 speed</option>
                        <option value="MERCHANT">Merchant (2000g, Lv4) - 5 cannons, 104 speed</option>
                        <option value="FRIGATE">Frigate (3000g, Lv5) - 6 cannons, 112 speed</option>
                        <option value="SPANISH_GALLEON">Spanish Galleon (5000g, Lv7) - 8 cannons, 100 speed</option>
                        <option value="WAR_GALLEON">War Galleon (8000g, Lv10) - 12 cannons, 91 speed</option>
                    </select>
                    <button id="upgradeShipBtn" onclick="upgradeShip()">Upgrade Ship</button>
                    <p id="upgradeStatus" style="color: red; font-size: 12px; margin-top: 5px;"></p>
                </div>

                <!-- Economy: Trade Goods (Phase 0) -->
                <div id="tradeSection"
                    style="margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px; display: none;">
                    <h3>‚öì Trade Goods</h3>

                    <!-- Cargo Display -->
                    <div id="cargoDisplay" style="margin-bottom: 15px;">
                        <p style="font-weight: bold;">Your Cargo:</p>
                        <div id="cargoList" style="font-size: 12px; margin-left: 10px;"></div>
                        <p id="cargoCapacity" style="font-size: 12px; color: #888;"></p>
                    </div>

                    <!-- Trade Interface -->
                    <div id="tradeInterface">
                        <p style="font-weight: bold;">Available Goods:</p>
                        <div id="goodsList"></div>
                    </div>

                    <!-- Transaction Feedback -->
                    <p id="transactionStatus"
                        style="color: #FFD700; font-size: 12px; margin-top: 10px; min-height: 16px;"></p>
                </div>

                <div id="harborActions">
                    <button id="repairBtn" onclick="repairShip()">Repair Flagship</button>
                    <button id="closeBtn" onclick="closeHarbor()">Set Sail</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mission Complete Overlay -->
    <div id="missionCompleteOverlay" style="display: none;">
        <div class="mission-complete-content">
            <h2>MISSION COMPLETE</h2>
            <p id="missionRewardText"></p>
        </div>
    </div>

    <!-- Mission UI Overlay (Top Left) -->
    <div id="missionUI" style="display: none;">
        <div id="missionContent">
            <h3 id="missionType">Current Mission</h3>
            <p id="missionDescription">Mission details...</p>
            <button id="cancelMissionBtn" onclick="cancelMission()">Cancel Mission</button>
        </div>
    </div>

    <!-- Changelog Overlay -->
    <div id="changelogOverlay" style="display: none;">
        <div class="changelog-content">
            <div class="changelog-header">
                <h2>üìú What's New</h2>
                <span id="changelogVersion" class="version-tag">v0.0.0</span>
            </div>
            <div id="changelogBody" class="changelog-body">
                <!-- Dynamic content will be inserted here -->
            </div>
            <div class="changelog-footer">
                <button id="closeChangelogBtn">Awesome!</button>
                <div class="changelog-hint">Press <strong>H</strong> to view anytime</div>
            </div>
        </div>
    </div>

    <!-- Controls Legend (Temporary - for testing) -->
    <div id="controlsLegend">
        <h3>‚öì Controls</h3>

        <div class="legend-section">
            <strong>Movement</strong>
            <div class="control-item"><kbd>A</kbd> / <kbd>D</kbd> - Turn left/right</div>
            <div class="control-item"><kbd>W</kbd> / <kbd>S</kbd> - Raise/lower sails</div>
            <div class="control-item-note">Sail levels: None ‚Üí Half ‚Üí Full</div>
        </div>

        <div class="legend-section">
            <strong>Combat</strong>
            <div class="control-item"><kbd>Q</kbd> - Fire port (left) broadside</div>
            <div class="control-item"><kbd>E</kbd> - Fire starboard (right) broadside</div>
        </div>

        <div class="legend-section">
            <strong>Interaction</strong>
            <div class="control-item"><kbd>F</kbd> - Dock in harbor / Loot wreck</div>
            <div class="control-item-note">Get new ships, repair, switch flagship, collect loot</div>
            <div class="control-item"><kbd>Enter</kbd> - Open chat</div>
            <div class="control-item-note">Send messages to other players</div>
        </div>

        <div class="legend-section">
            <strong>Debug (Testing)</strong>
            <div class="control-item"><kbd>P</kbd> - Spawn pirate NPC</div>
            <div class="control-item"><kbd>N</kbd> - Spawn merchant NPC</div>
            <div class="control-item"><kbd>T</kbd> - Teleport to harbor</div>
            <div class="control-item"><kbd>M</kbd> - Cycle minimap zoom</div>
            <div class="control-item"><kbd>U</kbd> - Toggle sound mute</div>
        </div>

        <div class="legend-section">
            <strong>Missions (Testing)</strong>
            <div class="control-item"><kbd>1</kbd> - Sail to harbor</div>
            <div class="control-item"><kbd>2</kbd> - Stay in area (10s)</div>
            <div class="control-item"><kbd>3</kbd> - Defeat 3 NPCs</div>
            <div class="control-item"><kbd>4</kbd> - Escort trader</div>
        </div>

        <div class="legend-section">
            <strong>Wind Mechanics</strong>
            <div class="control-item-note">Speed varies by wind direction:</div>
            <div class="control-item-note">‚Ä¢ Tailwind (behind): Fastest</div>
            <div class="control-item-note">‚Ä¢ Beam reach (side): Medium</div>
            <div class="control-item-note">‚Ä¢ Headwind (front): Slowest</div>
        </div>
    </div>



    <script src="/socket.io/socket.io.js"></script>
    <!-- DEBUG: Harbor teleport system - REMOVE BEFORE PRODUCTION -->
    <script src="js/harbor_teleport_debug.js"></script>
    <script src="js/tilemap_debug.js"></script>
    <!-- DEBUG: Minimap visualization - REMOVE BEFORE PRODUCTION -->
    <script src="js/minimap_debug.js"></script>
    <!-- Visual Adapter Layer - Client-side visual enhancements -->
    <script src="js/visual_adapter.js"></script>
    <script src="js/WakeRenderer.js"></script>
    <script src="js/SplashRenderer.js"></script>
    <!-- Sound System - Client-side audio management -->
    <script src="js/SoundManager.js"></script>
    <script src="js/game.js"></script>
    <script src="js/client.js"></script>
</body>

</html>