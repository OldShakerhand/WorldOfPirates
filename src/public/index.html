<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <title>World of Pirates</title>
    <link rel="stylesheet" href="mobile.css">
</head>

<body>
    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <!-- Mission UI Overlay (Top Left, below stats) -->
        <div id="missionUI" style="display: none;">
            <div id="missionContent">
                <h3 id="missionType">Current Mission</h3>
                <p id="missionDescription">Mission details...</p>
                <button id="cancelMissionBtn" onclick="cancelMission()">Cancel Mission</button>
            </div>
        </div>

        <!-- Controls Hint (Bottom Left, inside game view) -->
        <div id="controlsHint"
            style="position: absolute; bottom: 10px; left: 10px; color: rgba(255,255,255,0.7); font-size: 12px; font-family: monospace; z-index: 50; pointer-events: none; text-shadow: 1px 1px 2px black;">
            [H] Controls | [L] Changelog | [C] Chat
        </div>

        <!-- Chat Panel (Bottom Right) -->
        <div id="chatPanel">
            <div id="chatMessages"></div>
        </div>

        <!-- Chat Input (Bottom Right, above panel or overlay) -->
        <div id="chatInputContainer" style="display: none;">
            <input type="text" id="chatInput" placeholder="Press Enter to chat..." maxlength="200" autocomplete="off">
        </div>
    </div>

    <!-- Name Input Overlay -->
    <div id="nameInputOverlay">
        <div id="nameInputContent">
            <h1>‚öì World of Pirates ‚öì</h1>
            <p>Enter your captain's name to set sail!</p>
            <input type="text" id="playerNameInput" placeholder="Captain Name" maxlength="20" autocomplete="off">
            <div id="nameError" style="display: none;"></div>

            <!-- Custom spawn for testing -->
            <div style="margin: 10px 0; padding: 8px; background: rgba(0,0,0,0.3); border-radius: 3px;">
                <label style="font-size: 11px; color: #aaa;">Custom Spawn (testing only):</label><br>
                <input type="number" id="spawnX" placeholder="X" style="width: 80px; margin: 3px; padding: 4px;">
                <input type="number" id="spawnY" placeholder="Y" style="width: 80px; padding: 4px;">
            </div>

            <button id="setSailBtn">Set Sail! üè¥‚Äç‚ò†Ô∏è</button>
            <p class="hint">3-20 characters (letters, numbers, spaces)</p>
        </div>
    </div>




    <!-- Harbor UI Overlay -->
    <div id="harborUI" style="display: none;">
        <div id="harborContent">
            <h2 id="harborTitle">üè¥‚Äç‚ò†Ô∏è Harbor</h2>
            <div id="harborInfo">
                <!-- VIEW: Main Hub -->
                <div id="harbor-view-main" class="harbor-view">
                    <div class="harbor-main-layout">
                        <!-- Left: Actions -->
                        <div class="harbor-menu-column">
                            <button class="harbor-btn governor" onclick="showHarborView('governor')">üèõÔ∏è Governor's
                                Mansion</button>
                            <button class="harbor-btn merchant" onclick="showHarborView('merchant')">‚öñÔ∏è Merchant's
                                Market</button>
                            <button class="harbor-btn shipyard" onclick="showHarborView('shipyard')">‚öì Shipyard &
                                Docks</button>
                            <!-- Future: Tavern -->
                            <button class="harbor-btn tavern" disabled title="Coming Soon">üçª Tavern (Rumors)</button>
                        </div>

                        <!-- Right: Occupants -->
                        <div class="harbor-occupants-panel">
                            <h3>‚öì Docked Captains</h3>
                            <div id="harborOccupantsList">
                                <div style="color: #aaa; font-style: italic; padding: 10px;">Checking manifest...</div>
                            </div>
                        </div>
                    </div>

                    <div id="harborActions" style="margin-top: 20px;">
                        <button id="repairBtn" onclick="repairShip()">Repair Flagship</button>
                        <button id="closeBtn" onclick="closeHarbor()">üåä Set Sail</button>
                    </div>
                </div>

                <!-- VIEW: Shipyard -->
                <div id="harbor-view-shipyard" class="harbor-view hidden">
                    <div class="view-header">
                        <button class="back-btn" onclick="showHarborView('main')">‚¨Ö Back to Harbor</button>
                        <h3>‚öì Shipyard</h3>
                    </div>

                    <h3>Your Fleet:</h3>
                    <div id="fleetList"></div>

                    <h3>Change Flagship:</h3>
                    <!-- IMPORTANT: Ship stats must match src/server/game/ShipClass.js -->
                    <select id="shipSelector">
                        <option value="SLOOP">Sloop (2 cannons/side, 131 speed)</option>
                        <option value="BARQUE">Barque (3 cannons/side, 120 speed)</option>
                        <option value="FLUYT">Fluyt (4 cannons/side, 115 speed)</option>
                        <option value="MERCHANT">Merchant (5 cannons/side, 104 speed)</option>
                        <option value="FRIGATE">Frigate (6 cannons/side, 112 speed)</option>
                        <option value="SPANISH_GALLEON">Spanish Galleon (8 cannons/side, 100 speed)</option>
                        <option value="WAR_GALLEON">War Galleon (12 cannons/side, 91 speed)</option>
                    </select>
                    <button id="switchShipBtn" onclick="switchFlagship()">Switch Flagship</button>

                    <!-- Ship Upgrade Section -->
                    <div id="upgradeSection" style="margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px;">
                        <h3>Upgrade Ship</h3>
                        <p id="playerResources" style="font-weight: bold; color: #FFD700;">Gold: 0 | Level: 1</p>
                        <select id="upgradeShipSelector">
                            <option value="SLOOP">Sloop (500g, Lv1) - 2 cannons, 131 speed</option>
                            <option value="BARQUE">Barque (1000g, Lv2) - 3 cannons, 120 speed</option>
                            <option value="FLUYT">Fluyt (1500g, Lv3) - 4 cannons, 115 speed</option>
                            <option value="MERCHANT">Merchant (2000g, Lv4) - 5 cannons, 104 speed</option>
                            <option value="FRIGATE">Frigate (3000g, Lv5) - 6 cannons, 112 speed</option>
                            <option value="SPANISH_GALLEON">Spanish Galleon (5000g, Lv7) - 8 cannons, 100 speed</option>
                            <option value="WAR_GALLEON">War Galleon (8000g, Lv10) - 12 cannons, 91 speed</option>
                        </select>
                        <button id="upgradeShipBtn" onclick="upgradeShip()">Upgrade Ship</button>
                        <p id="upgradeStatus" style="color: red; font-size: 12px; margin-top: 5px;"></p>
                    </div>
                </div>

                <!-- VIEW: Governor -->
                <div id="harbor-view-governor" class="harbor-view hidden">
                    <div class="view-header">
                        <button class="back-btn" onclick="showHarborView('main')">‚¨Ö Back to Harbor</button>
                        <h3>üèõÔ∏è Governor's Mansion</h3>
                    </div>

                    <div id="governorSection">
                        <h3>Available Missions</h3>
                        <div id="missionList"></div>
                    </div>
                </div>

                <!-- VIEW: Merchant -->
                <div id="harbor-view-merchant" class="harbor-view hidden">
                    <div class="view-header">
                        <button class="back-btn" onclick="showHarborView('main')">‚¨Ö Back to Harbor</button>
                        <h3>‚öñÔ∏è Merchant's Market</h3>
                    </div>

                    <div id="tradeSection">
                        <!-- Cargo Display -->
                        <div id="cargoDisplay" style="margin-bottom: 15px;">
                            <p style="font-weight: bold;">Your Cargo:</p>
                            <div id="cargoList" style="font-size: 12px; margin-left: 10px;"></div>
                            <p id="cargoCapacity" style="font-size: 12px; color: #888;"></p>
                        </div>

                        <!-- Trade Interface -->
                        <div id="tradeInterface">
                            <p style="font-weight: bold;">Available Goods:</p>
                            <div id="goodsList"></div>
                        </div>

                        <!-- Transaction Feedback -->
                        <p id="transactionStatus"
                            style="color: #FFD700; font-size: 12px; margin-top: 10px; min-height: 16px;"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mission Complete Overlay -->
    <div id="missionCompleteOverlay" style="display: none;">
        <div class="mission-complete-content">
            <h2>MISSION COMPLETE</h2>
            <p id="missionRewardText"></p>
        </div>
    </div>



    <!-- Changelog Overlay -->
    <div id="changelogOverlay" style="display: none;">
        <div class="changelog-content">
            <div class="changelog-header">
                <h2>üìú What's New</h2>
                <span id="changelogVersion" class="version-tag">v0.0.0</span>
            </div>
            <div id="changelogBody" class="changelog-body">
                <!-- Dynamic content will be inserted here -->
            </div>
            <div class="changelog-footer">
                <button id="closeChangelogBtn">Awesome!</button>
                <div class="changelog-hint">Press <strong>L</strong> to view anytime</div>
            </div>
        </div>
    </div>



    <!-- Controls Legend (Hidden by default, toggle with H) -->
    <div id="controlsLegend" style="display: none;">
        <h3>‚öì Controls</h3>

        <div class="legend-section">
            <strong>Movement</strong>
            <div class="control-item"><kbd>A</kbd> / <kbd>D</kbd> - Turn left/right</div>
            <div class="control-item"><kbd>W</kbd> / <kbd>S</kbd> - Raise/lower sails</div>
            <div class="control-item-note">Sail levels: None ‚Üí Half ‚Üí Full</div>
        </div>

        <div class="legend-section">
            <strong>Combat</strong>
            <div class="control-item"><kbd>Q</kbd> - Fire port (left) broadside</div>
            <div class="control-item"><kbd>E</kbd> - Fire starboard (right) broadside</div>
        </div>

        <div class="legend-section">
            <strong>Interaction</strong>
            <div class="control-item"><kbd>F</kbd> - Dock in harbor / Loot wreck</div>
            <div class="control-item-note">Get new ships, repair, switch flagship, collect loot</div>
            <div class="control-item"><kbd>Enter</kbd> - Open chat</div>
            <div class="control-item-note">Send messages to other players</div>
            <div class="control-item"><kbd>H</kbd> - Toggle Controls</div>
            <div class="control-item"><kbd>L</kbd> - What's New</div>
        </div>

        <div class="legend-section">
            <strong>Debug (Testing)</strong>
            <div class="control-item"><kbd>P</kbd> - Spawn pirate NPC</div>
            <div class="control-item"><kbd>N</kbd> - Spawn merchant NPC</div>
            <div class="control-item"><kbd>T</kbd> - Teleport to harbor</div>
            <div class="control-item"><kbd>M</kbd> - Cycle minimap zoom</div>
            <div class="control-item"><kbd>U</kbd> - Toggle sound mute</div>
        </div>

        <div class="legend-section">
            <strong>Missions (Testing)</strong>
            <div class="control-item"><kbd>1</kbd> - Sail to harbor</div>
            <div class="control-item"><kbd>2</kbd> - Stay in area (10s)</div>
            <div class="control-item"><kbd>3</kbd> - Defeat 3 NPCs</div>
            <div class="control-item"><kbd>4</kbd> - Escort trader</div>
        </div>

        <div class="legend-section">
            <strong>Wind Mechanics</strong>
            <div class="control-item-note">Speed varies by wind direction:</div>
            <div class="control-item-note">‚Ä¢ Tailwind (behind): Fastest</div>
            <div class="control-item-note">‚Ä¢ Beam reach (side): Medium</div>
            <div class="control-item-note">‚Ä¢ Headwind (front): Slowest</div>
        </div>
    </div>



    <script src="/socket.io/socket.io.js"></script>
    <!-- DEBUG: Harbor teleport system - REMOVE BEFORE PRODUCTION -->
    <script src="js/harbor_teleport_debug.js"></script>
    <script src="js/tilemap_debug.js"></script>
    <!-- DEBUG: Minimap visualization - REMOVE BEFORE PRODUCTION -->
    <script src="js/minimap_debug.js"></script>
    <!-- Visual Adapter Layer - Client-side visual enhancements -->
    <script src="js/visual_adapter.js"></script>
    <script src="js/WakeRenderer.js"></script>
    <script src="js/SplashRenderer.js"></script>
    <!-- Sound System - Client-side audio management -->
    <script src="js/SoundManager.js"></script>
    <script src="js/MobileControls.js"></script>
    <script src="js/game.js"></script>
    <script src="js/client.js"></script>
</body>

</html>